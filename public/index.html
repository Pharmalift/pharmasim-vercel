<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PharmaSim Pro | Pharmalift Solutions</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #0f172a, #1e293b); min-height: 100vh; color: #f8fafc; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 30px; }
        .logo { display: flex; align-items: center; gap: 12px; }
        .logo-icon { width: 50px; height: 50px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 28px; }
        .logo h1 { font-size: 24px; }
        .logo h1 span { color: #3b82f6; }
        .badge-pro { background: linear-gradient(135deg, #f59e0b, #d97706); padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 700; margin-left: 8px; }
        .status-badge { padding: 8px 16px; border-radius: 20px; font-size: 12px; font-weight: 600; background: rgba(139,92,246,0.2); color: #a78bfa; }
        .category-title { font-size: 16px; margin: 32px 0 16px; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.08); color: #e2e8f0; }
        .category-title:first-of-type { margin-top: 0; }
        .section-title { font-size: 20px; font-weight: 700; margin: 40px 0 8px; padding: 12px 0; border-bottom: 2px solid rgba(255,255,255,0.15); color: #f8fafc; }
        .section-title:first-of-type { margin-top: 0; }
        .scenario-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 16px; margin-bottom: 20px; }
        .scenario-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 20px; cursor: pointer; transition: all 0.3s; }
        .scenario-card:hover { background: rgba(255,255,255,0.08); border-color: #3b82f6; transform: translateY(-2px); }
        .scenario-card .avatar { width: 52px; height: 52px; background: linear-gradient(135deg, #fbbf24, #f59e0b); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 26px; margin-bottom: 12px; }
        .scenario-card h3 { font-size: 16px; margin-bottom: 6px; }
        .scenario-card p { font-size: 12px; color: #94a3b8; line-height: 1.4; }
        .game-container { display: none; grid-template-columns: 1fr 320px; gap: 24px; }
        .game-container.active { display: grid; }
        .chat-panel { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; overflow: hidden; }
        .chat-header { background: linear-gradient(135deg, #3b82f6, #8b5cf6); padding: 20px; display: flex; align-items: center; gap: 16px; }
        .chat-header .avatar { width: 50px; height: 50px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 26px; }
        .chat-header h3 { font-size: 18px; }
        .chat-header p { font-size: 12px; opacity: 0.8; }
        .messages { height: 400px; overflow-y: auto; padding: 20px; background: #0f172a; }
        .message { display: flex; gap: 12px; margin-bottom: 16px; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .message.pharmacist { flex-direction: row-reverse; }
        .message .avatar { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
        .message.patient .avatar { background: #fbbf24; }
        .message.pharmacist .avatar { background: #3b82f6; }
        .message .bubble { max-width: 70%; padding: 12px 16px; border-radius: 16px; font-size: 14px; line-height: 1.5; }
        .message.patient .bubble { background: rgba(255,255,255,0.08); }
        .message.pharmacist .bubble { background: #3b82f6; }
        .typing .dots { display: flex; gap: 4px; padding: 12px 16px; background: rgba(255,255,255,0.08); border-radius: 16px; }
        .typing .dots span { width: 8px; height: 8px; background: #64748b; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; }
        .typing .dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing .dots span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        .input-area { padding: 20px; background: rgba(255,255,255,0.02); border-top: 1px solid rgba(255,255,255,0.1); }
        .suggestions { display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap; }
        .suggestions button { padding: 8px 12px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; font-size: 11px; color: #94a3b8; cursor: pointer; }
        .suggestions button:hover { background: rgba(59,130,246,0.2); border-color: #3b82f6; color: #60a5fa; }
        .input-row { display: flex; gap: 12px; }
        .input-row input { flex: 1; padding: 14px 18px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: #f8fafc; font-size: 14px; }
        .input-row input:focus { outline: none; border-color: #3b82f6; }
        .input-row input::placeholder { color: #64748b; }
        .input-row button { padding: 14px 24px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); border: none; border-radius: 12px; color: white; font-weight: 600; cursor: pointer; }
        .input-row button:disabled { opacity: 0.5; }
        .actions { display: flex; justify-content: space-between; margin-top: 12px; }
        .back-btn, .end-btn { padding: 10px; background: transparent; border: none; color: #64748b; font-size: 13px; cursor: pointer; }
        .end-btn { color: #f87171; }
        .side-panel { display: flex; flex-direction: column; gap: 16px; }
        .panel-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 20px; }
        .panel-card h3 { font-size: 14px; color: #94a3b8; margin-bottom: 12px; }
        .score-value { font-size: 32px; font-weight: 700; color: #4ade80; }
        .score-bar-bg { height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; margin-top: 12px; }
        .score-bar { height: 100%; background: #4ade80; border-radius: 4px; transition: width 0.5s; }
        footer { text-align: center; padding: 40px; color: #475569; font-size: 12px; }
        @media (max-width: 900px) { .game-container.active { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">ğŸ’Š</div>
                <div><h1>Pharma<span>Sim</span><span class="badge-pro">PRO</span></h1></div>
            </div>
            <div class="status-badge">ğŸ¤– PropulsÃ© par Claude AI</div>
        </header>
        <div id="scenarioSelection">
            <h2 style="margin-bottom:24px;">Choisissez un scÃ©nario</h2>

            <h2 class="section-title">ğŸ¥ ScÃ©narios Patients</h2>

            <h3 class="category-title">ğŸ”´ Risques critiques</h3>
            <div class="scenario-grid">
                <div class="scenario-card" onclick="selectScenario('douleur_thoracique')">
                    <div class="avatar" style="background:linear-gradient(135deg,#ef4444,#dc2626);">âš ï¸</div>
                    <h3>M. Durand</h3>
                    <p>45 ans â€¢ Douleur thoracique. Signes d'alerte cardiaque Ã  repÃ©rer !</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('femme_enceinte_medicaments')">
                    <div class="avatar" style="background:linear-gradient(135deg,#f472b6,#ec4899);">ğŸ¤°</div>
                    <h3>Mme Laurent</h3>
                    <p>29 ans â€¢ Enceinte avec nausÃ©es. A pris un AINS sans le savoir.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('personne_agee_polymediquee')">
                    <div class="avatar" style="background:linear-gradient(135deg,#a78bfa,#7c3aed);">ğŸ‘µ</div>
                    <h3>Mme Mercier</h3>
                    <p>82 ans â€¢ 12 mÃ©dicaments, confuse. IatrogÃ©nie et chutes Ã  dÃ©tecter.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('intoxication_enfant')">
                    <div class="avatar" style="background:linear-gradient(135deg,#ef4444,#b91c1c);">ğŸ†˜</div>
                    <h3>Mme Girard</h3>
                    <p>Enfant 2 ans a avalÃ© des mÃ©dicaments. Gestion urgence toxicologique.</p>
                </div>
            </div>

            <h3 class="category-title">ğŸŸ  Conseil spÃ©cialisÃ©</h3>
            <div class="scenario-grid">
                <div class="scenario-card" onclick="selectScenario('mme_dubois')">
                    <div class="avatar">ğŸ‘©â€ğŸ¦³</div>
                    <h3>Mme Dubois</h3>
                    <p>58 ans â€¢ Ordonnance + maux de tÃªte. Interactions cachÃ©es.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('aromatherapie')">
                    <div class="avatar" style="background:linear-gradient(135deg,#34d399,#10b981);">ğŸŒ¿</div>
                    <h3>Mme Martin</h3>
                    <p>42 ans â€¢ Huiles essentielles stress/sommeil. Anxiolytique cachÃ©.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('phytotherapie_prostate')">
                    <div class="avatar" style="background:linear-gradient(135deg,#22c55e,#16a34a);">ğŸŒ±</div>
                    <h3>M. Bernard</h3>
                    <p>62 ans â€¢ Prostate, veut du naturel. Traitement arrÃªtÃ©, PSA non suivi.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('micronutrition_fatigue')">
                    <div class="avatar" style="background:linear-gradient(135deg,#fb923c,#f97316);">ğŸ¥—</div>
                    <h3>Mme Faure</h3>
                    <p>35 ans â€¢ Fatigue intense, jeune maman. Carences cachÃ©es.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('menopause')">
                    <div class="avatar" style="background:linear-gradient(135deg,#f9a8d4,#ec4899);">ğŸŒ¸</div>
                    <h3>Mme Blanchard</h3>
                    <p>52 ans â€¢ MÃ©nopause, refuse le THS. AntÃ©cÃ©dent familial cancer.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('detox_drainage')">
                    <div class="avatar" style="background:linear-gradient(135deg,#86efac,#22c55e);">ğŸ§ƒ</div>
                    <h3>Mme Petit</h3>
                    <p>28 ans â€¢ Cure dÃ©tox Instagram. Possible TCA Ã  dÃ©pister.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('sport_recuperation')">
                    <div class="avatar" style="background:linear-gradient(135deg,#60a5fa,#3b82f6);">ğŸƒ</div>
                    <h3>Thomas</h3>
                    <p>32 ans â€¢ Marathon, courbatures. Hydratation et progressivitÃ©.</p>
                </div>
            </div>

            <h3 class="category-title">ğŸŸ¡ Populations spÃ©cifiques</h3>
            <div class="scenario-grid">
                <div class="scenario-card" onclick="selectScenario('pediatrie')">
                    <div class="avatar" style="background:linear-gradient(135deg,#60a5fa,#3b82f6);">ğŸ‘¶</div>
                    <h3>M. Petit (pÃ¨re)</h3>
                    <p>Enfant 3 ans fiÃ©vreux. Convulsion fÃ©brile Ã  dÃ©tecter.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('bebe_coliques')">
                    <div class="avatar" style="background:linear-gradient(135deg,#fbbf24,#f59e0b);">ğŸ‘¶</div>
                    <h3>Mme Dupont</h3>
                    <p>BÃ©bÃ© 3 semaines, coliques. Baby blues maternel Ã  dÃ©pister.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('personne_agee_isolee')">
                    <div class="avatar" style="background:linear-gradient(135deg,#94a3b8,#64748b);">ğŸ§“</div>
                    <h3>M. Martin</h3>
                    <p>78 ans â€¢ Confus, isolÃ©. FragilitÃ© et risque domestique.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('femme_enceinte_rhume')">
                    <div class="avatar" style="background:linear-gradient(135deg,#fca5a5,#f87171);">ğŸ¤§</div>
                    <h3>Mme Chen</h3>
                    <p>34 ans â€¢ Enceinte, rhume et fiÃ¨vre. AutomÃ©dication Ã  risque.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('patient_diabetique')">
                    <div class="avatar" style="background:linear-gradient(135deg,#c084fc,#a855f7);">ğŸ’‰</div>
                    <h3>M. KonÃ©</h3>
                    <p>58 ans â€¢ DiabÃ©tique, veut un sirop. Adaptation au terrain.</p>
                </div>
            </div>

            <h3 class="category-title">ğŸŸ¢ Dermatologie comptoir</h3>
            <div class="scenario-grid">
                <div class="scenario-card" onclick="selectScenario('dermato')">
                    <div class="avatar" style="background:linear-gradient(135deg,#f472b6,#ec4899);">ğŸ’†</div>
                    <h3>Emma</h3>
                    <p>16 ans â€¢ AcnÃ©. Produits internet dangereux.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('eczema_bebe')">
                    <div class="avatar" style="background:linear-gradient(135deg,#fbbf24,#f59e0b);">ğŸ‘§</div>
                    <h3>Mme Dubois-Morel</h3>
                    <p>BÃ©bÃ© 8 mois, eczÃ©ma. Corticophobie Ã  lever.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('mycose_pied')">
                    <div class="avatar" style="background:linear-gradient(135deg,#34d399,#10b981);">ğŸ¦¶</div>
                    <h3>M. Fernandez</h3>
                    <p>42 ans â€¢ Mycose pied, piscine. DiabÃ¨te non signalÃ©.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('poux')">
                    <div class="avatar" style="background:linear-gradient(135deg,#fb923c,#f97316);">ğŸª³</div>
                    <h3>Mme Martinez</h3>
                    <p>3 enfants, poux rÃ©cidivants. Traitement incomplet.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('coup_de_soleil')">
                    <div class="avatar" style="background:linear-gradient(135deg,#fbbf24,#f59e0b);">â˜€ï¸</div>
                    <h3>Lucas</h3>
                    <p>22 ans â€¢ Coup de soleil sÃ©vÃ¨re. MÃ©dicament photosensibilisant.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('herpes_labial')">
                    <div class="avatar" style="background:linear-gradient(135deg,#f9a8d4,#ec4899);">ğŸ’‹</div>
                    <h3>Julie</h3>
                    <p>27 ans â€¢ HerpÃ¨s rÃ©cidivant. ContagiositÃ© et prÃ©vention.</p>
                </div>
            </div>

            <h3 class="category-title">ğŸ”µ Situations dÃ©licates</h3>
            <div class="scenario-grid">
                <div class="scenario-card" onclick="selectScenario('veterinaire')">
                    <div class="avatar" style="background:linear-gradient(135deg,#a78bfa,#7c3aed);">ğŸ±</div>
                    <h3>Mme Rossi</h3>
                    <p>55 ans â€¢ Chat malade. Advil donnÃ© Ã  l'animal.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('contraception_urgence')">
                    <div class="avatar" style="background:linear-gradient(135deg,#60a5fa,#3b82f6);">ğŸ’Š</div>
                    <h3>Claire</h3>
                    <p>19 ans â€¢ Contraception d'urgence. Oublis rÃ©currents.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('test_grossesse_positif')">
                    <div class="avatar" style="background:linear-gradient(135deg,#c4b5fd,#8b5cf6);">ğŸ¥º</div>
                    <h3>InÃ¨s</h3>
                    <p>23 ans â€¢ Test positif, en pleurs. Ã‰coute et orientation.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('sevrage_tabac')">
                    <div class="avatar" style="background:linear-gradient(135deg,#94a3b8,#64748b);">ğŸš¬</div>
                    <h3>M. Leroy</h3>
                    <p>55 ans â€¢ Veut arrÃªter de fumer. BPCO, forte dÃ©pendance.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('dependance_benzodiazepines')">
                    <div class="avatar" style="background:linear-gradient(135deg,#fca5a5,#f87171);">ğŸ˜°</div>
                    <h3>Mme Roux</h3>
                    <p>65 ans â€¢ Demande Lexomil sans ordonnance. DÃ©pendance.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('patient_agressif')">
                    <div class="avatar" style="background:linear-gradient(135deg,#ef4444,#dc2626);">ğŸ˜ </div>
                    <h3>M. Sanchez</h3>
                    <p>40 ans â€¢ Rupture mÃ©dicament. DÃ©sescalade et empathie.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('suspicion_maltraitance')">
                    <div class="avatar" style="background:linear-gradient(135deg,#475569,#334155);">ğŸ’”</div>
                    <h3>TimÃ©o (7 ans)</h3>
                    <p>Bleus rÃ©currents. Observation et protocole signalement.</p>
                </div>
            </div>

            <h2 class="section-title">ğŸ’¼ ScÃ©narios Management</h2>

            <h3 class="category-title">ğŸŸ¤ Management & Gestion d'Officine</h3>
            <div class="scenario-grid">
                <div class="scenario-card" onclick="selectScenario('delegue_insistant')">
                    <div class="avatar" style="background:linear-gradient(135deg,#78716c,#57534e);">ğŸ‘”</div>
                    <h3>Marc</h3>
                    <p>DÃ©lÃ©guÃ© Pharma GÃ©nÃ©rix â€¢ Offre agressive Ã  analyser.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('conflit_equipe')">
                    <div class="avatar" style="background:linear-gradient(135deg,#f87171,#ef4444);">ğŸ˜¤</div>
                    <h3>Sophie</h3>
                    <p>PrÃ©paratrice â€¢ Conflit d'Ã©quipe. Ã‰coute et mÃ©diation.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('demande_augmentation')">
                    <div class="avatar" style="background:linear-gradient(135deg,#fbbf24,#f59e0b);">ğŸ’°</div>
                    <h3>Julie</h3>
                    <p>Adjointe 4 ans â€¢ Demande d'augmentation. NÃ©gociation.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('erreur_delivrance')">
                    <div class="avatar" style="background:linear-gradient(135deg,#fb923c,#f97316);">ğŸ˜°</div>
                    <h3>Karim</h3>
                    <p>PrÃ©parateur junior â€¢ Erreur de dÃ©livrance. Feedback constructif.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('client_prix_internet')">
                    <div class="avatar" style="background:linear-gradient(135deg,#60a5fa,#3b82f6);">ğŸ›’</div>
                    <h3>M. Morel</h3>
                    <p>Client â€¢ Prix vs internet. Argumenter la valeur ajoutÃ©e.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('negociation_grossiste')">
                    <div class="avatar" style="background:linear-gradient(135deg,#a78bfa,#7c3aed);">ğŸ“Š</div>
                    <h3>FranÃ§ois</h3>
                    <p>Dir. rÃ©gional grossiste â€¢ NÃ©gociation commerciale annuelle.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('recadrage_retards')">
                    <div class="avatar" style="background:linear-gradient(135deg,#94a3b8,#64748b);">â°</div>
                    <h3>Thomas</h3>
                    <p>PrÃ©parateur â€¢ Retards rÃ©pÃ©tÃ©s. Recadrage bienveillant.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('avis_google_negatif')">
                    <div class="avatar" style="background:linear-gradient(135deg,#fca5a5,#f87171);">â­</div>
                    <h3>Mme Fontaine</h3>
                    <p>Cliente furieuse â€¢ Avis 1 Ã©toile. Gestion e-rÃ©putation.</p>
                </div>
            </div>
        </div>
        <div id="gameContainer" class="game-container">
            <div class="chat-panel">
                <div class="chat-header">
                    <div class="avatar" id="patientAvatar">ğŸ‘©â€ğŸ¦³</div>
                    <div><p id="chatLabel" style="font-size:10px;opacity:0.7;margin-bottom:2px;">ğŸ¥ Patient</p><h3 id="patientName">Patient</h3><p id="patientInfo">Info</p></div>
                </div>
                <div id="messages" class="messages"></div>
                <div class="input-area">
                    <div id="suggestions" class="suggestions"></div>
                    <div class="input-row">
                        <input type="text" id="userInput" placeholder="Posez votre question..." onkeypress="if(event.key==='Enter')sendMessage()">
                        <button id="sendBtn" onclick="sendMessage()">Envoyer</button>
                    </div>
                    <div class="actions">
                        <button class="back-btn" onclick="backToSelection()">â† Retour</button>
                        <button class="end-btn" onclick="endSimulation()">ğŸ Terminer</button>
                    </div>
                </div>
            </div>
            <div class="side-panel">
                <div class="panel-card">
                    <h3>ğŸ“Š Score</h3>
                    <div class="score-value" id="scoreValue">0</div>
                    <div class="score-bar-bg"><div id="scoreBar" class="score-bar" style="width:0%"></div></div>
                </div>
            </div>
        </div>
        <footer>PharmaSim Pro Â© 2026 Pharmalift Solutions â€¢ Certification Qualiopi</footer>
    </div>
    <script>
        const SCENARIOS = {
            douleur_thoracique: { name: "M. Durand", age: 45, avatar: "âš ï¸", info: "PressÃ©, minimise", suggestions: ["OÃ¹ exactement la douleur ?", "Irradiation bras ?", "Essoufflement ?", "AntÃ©cÃ©dents familiaux ?"] },
            femme_enceinte_medicaments: { name: "Mme Laurent", age: 29, avatar: "ğŸ¤°", info: "Enceinte, inquiÃ¨te", suggestions: ["Pris quelque chose ?", "Quel trimestre ?", "Vomissements ?", "Suivi par qui ?"] },
            personne_agee_polymediquee: { name: "Mme Mercier", age: 82, avatar: "ğŸ‘µ", info: "Confuse, polymÃ©diquÃ©e", suggestions: ["Combien de mÃ©dicaments ?", "Chutes rÃ©centes ?", "Vivez seule ?", "Mangez bien ?"] },
            intoxication_enfant: { name: "Mme Girard", age: 30, avatar: "ğŸ†˜", info: "PaniquÃ©e", suggestions: ["Quel mÃ©dicament ?", "Combien de comprimÃ©s ?", "Il y a combien de temps ?", "Poids de l'enfant ?"] },
            mme_dubois: { name: "Mme Dubois", age: 58, avatar: "ğŸ‘©â€ğŸ¦³", info: "PressÃ©e mais coopÃ©rative", suggestions: ["Autres mÃ©dicaments ?", "Pris quelque chose ce matin ?", "AntÃ©cÃ©dents ?", "DÃ©crivez la douleur"] },
            aromatherapie: { name: "Mme Martin", age: 42, avatar: "ğŸŒ¿", info: "Anxieuse, cherche du naturel", suggestions: ["Prenez-vous des mÃ©dicaments ?", "Utilisez dÃ©jÃ  des HE ?", "AntÃ©cÃ©dents respiratoires ?", "Allergies cutanÃ©es ?"] },
            phytotherapie_prostate: { name: "M. Bernard", age: 62, avatar: "ğŸŒ±", info: "MÃ©fiant, prÃ©fÃ¨re le naturel", suggestions: ["Autres mÃ©dicaments ?", "Traitement prescrit ?", "Suivi urologique ?", "Sang dans les urines ?"] },
            micronutrition_fatigue: { name: "Mme Faure", age: 35, avatar: "ğŸ¥—", info: "Ã‰puisÃ©e, jeune maman", suggestions: ["Vous allaitez ?", "RÃ©gime alimentaire ?", "Autres symptÃ´mes ?", "RÃ¨gles normales ?"] },
            menopause: { name: "Mme Blanchard", age: 52, avatar: "ğŸŒ¸", info: "GÃªnÃ©e, bouffÃ©es de chaleur", suggestions: ["Pourquoi refuser le THS ?", "Prenez des complÃ©ments ?", "Sommeil ?", "AntÃ©cÃ©dents familiaux ?"] },
            detox_drainage: { name: "Mme Petit", age: 28, avatar: "ğŸ§ƒ", info: "InfluencÃ©e, wellness", suggestions: ["RÃ©gime alimentaire ?", "Perte de poids rÃ©cente ?", "Laxatifs ?", "Cheveux, ongles ?"] },
            sport_recuperation: { name: "Thomas", age: 32, avatar: "ğŸƒ", info: "Sportif motivÃ©", suggestions: ["Hydratation ?", "ComplÃ©ments pris ?", "Crampes ?", "Depuis quand le sport ?"] },
            pediatrie: { name: "M. Petit", age: 35, avatar: "ğŸ‘¶", info: "PÃ¨re inquiet", suggestions: ["Quelle tempÃ©rature ?", "DÃ©jÃ  donnÃ© quelque chose ?", "AntÃ©cÃ©dents de Lucas ?", "Combien pÃ¨se-t-il ?"] },
            bebe_coliques: { name: "Mme Dupont", age: 30, avatar: "ğŸ‘¶", info: "Ã‰puisÃ©e, premier bÃ©bÃ©", suggestions: ["Allaitement ou biberon ?", "Vu le pÃ©diatre ?", "RÃ©gurgitations ?", "Comment vous sentez-vous ?"] },
            personne_agee_isolee: { name: "M. Martin", age: 78, avatar: "ğŸ§“", info: "Fier, refuse l'aide", suggestions: ["Vivez seul ?", "Mangez bien ?", "Oubliez vos mÃ©dicaments ?", "Besoin d'aide au quotidien ?"] },
            femme_enceinte_rhume: { name: "Mme Chen", age: 34, avatar: "ğŸ¤§", info: "Enceinte, enrhumÃ©e", suggestions: ["Avez-vous de la fiÃ¨vre ?", "Pris quelque chose ?", "AppelÃ© la sage-femme ?", "Depuis quand ?"] },
            patient_diabetique: { name: "M. KonÃ©", age: 58, avatar: "ğŸ’‰", info: "DiabÃ©tique, aime le sucrÃ©", suggestions: ["ÃŠtes-vous diabÃ©tique ?", "Sirop sans sucre ?", "Suivi rÃ©gulier ?", "Pieds, sensations ?"] },
            dermato: { name: "Emma", age: 16, avatar: "ğŸ’†", info: "Timide, gÃªnÃ©e", suggestions: ["Produits utilisÃ©s ?", "Type de peau ?", "Routine actuelle ?", "Depuis combien de temps ?"] },
            eczema_bebe: { name: "Mme Dubois-Morel", age: 32, avatar: "ğŸ‘§", info: "Corticophobie", suggestions: ["Appliquez la crÃ¨me prescrite ?", "CrÃ¨mes utilisÃ©es ?", "Asthme familial ?", "BÃ©bÃ© dort bien ?"] },
            mycose_pied: { name: "M. Fernandez", age: 42, avatar: "ğŸ¦¶", info: "GÃªnÃ©, sportif", suggestions: ["Depuis combien de temps ?", "Piscine, sport ?", "DiabÃ©tique ?", "DÃ©jÃ  traitÃ© ?"] },
            poux: { name: "Mme Martinez", age: 38, avatar: "ğŸª³", info: "DÃ©bordÃ©e, 3 enfants", suggestions: ["Parents traitÃ©s aussi ?", "Literie lavÃ©e ?", "Produit utilisÃ© ?", "Ã‰cole prÃ©venue ?"] },
            coup_de_soleil: { name: "Lucas", age: 22, avatar: "â˜€ï¸", info: "Ã‰tudiant, fÃªte plage", suggestions: ["Des cloques ?", "Prenez des mÃ©dicaments ?", "CrÃ¨me solaire ?", "Grains de beautÃ© ?"] },
            herpes_labial: { name: "Julie", age: 27, avatar: "ğŸ’‹", info: "StressÃ©e, entretien demain", suggestions: ["FrÃ©quence des poussÃ©es ?", "Quand avez-vous appliquÃ© ?", "Contagion, prÃ©cautions ?", "Vu un mÃ©decin ?"] },
            veterinaire: { name: "Mme Rossi", age: 55, avatar: "ğŸ±", info: "PropriÃ©taire inquiÃ¨te", suggestions: ["DonnÃ© quelque chose au chat ?", "Vu le vÃ©tÃ©rinaire ?", "Perte de poids ?", "Depuis combien de temps ?"] },
            contraception_urgence: { name: "Claire", age: 19, avatar: "ğŸ’Š", info: "GÃªnÃ©e, stressÃ©e", suggestions: ["Il y a combien de temps ?", "Contraception habituelle ?", "Cycle rÃ©gulier ?", "Suivi gynÃ©co ?"] },
            test_grossesse_positif: { name: "InÃ¨s", age: 23, avatar: "ğŸ¥º", info: "En pleurs, perdue", suggestions: ["Souhaitez-vous en parler ?", "EntourÃ©e ?", "Connaissez vos options ?", "Suivi mÃ©dical ?"] },
            sevrage_tabac: { name: "M. Leroy", age: 55, avatar: "ğŸš¬", info: "Fumeur, sceptique", suggestions: ["Combien par jour ?", "PremiÃ¨re cigarette quand ?", "DÃ©jÃ  essayÃ© quoi ?", "ProblÃ¨mes respiratoires ?"] },
            dependance_benzodiazepines: { name: "Mme Roux", age: 65, avatar: "ğŸ˜°", info: "Anxieuse, suppliante", suggestions: ["Depuis combien de temps ?", "Doses augmentÃ©es ?", "Autres somnifÃ¨res ?", "Votre mÃ©decin en pense quoi ?"] },
            patient_agressif: { name: "M. Sanchez", age: 40, avatar: "ğŸ˜ ", info: "En colÃ¨re", suggestions: ["Depuis quand sans traitement ?", "SymptÃ´mes de manque ?", "On peut chercher une solution", "MÃ©decin joignable ?"] },
            suspicion_maltraitance: { name: "MÃ¨re de TimÃ©o", age: 35, avatar: "ğŸ’”", info: "RÃ©pond Ã  la place de l'enfant", suggestions: ["Comment c'est arrivÃ© ?", "DÃ©jÃ  arrivÃ© avant ?", "TimÃ©o, tu peux me montrer ?", "D'autres bleus ?"] },
            // Management
            delegue_insistant: { name: "Marc", type: "management", role: "DÃ©lÃ©guÃ© Pharma GÃ©nÃ©rix", avatar: "ğŸ‘”", info: "Commercial, insistant", suggestions: ["Minimum de commande ?", "Historique de ruptures ?", "Marge rÃ©elle vs princeps ?", "Pourquoi cette offre maintenant ?"] },
            conflit_equipe: { name: "Sophie", type: "management", role: "PrÃ©paratrice", avatar: "ğŸ˜¤", info: "Ã€ cran, se sent lÃ©sÃ©e", suggestions: ["Depuis combien de temps ?", "Y a-t-il eu des changements rÃ©cents ?", "Comment vous sentez-vous ?", "Une mÃ©diation avec Marie ?"] },
            demande_augmentation: { name: "Julie", type: "management", role: "Pharmacienne adjointe (4 ans)", avatar: "ğŸ’°", info: "FidÃ¨le, argumentaire prÃ©parÃ©", suggestions: ["Des propositions ailleurs ?", "Quelles responsabilitÃ©s souhaitez-vous ?", "Quel montant envisagez-vous ?", "Comment valoriser votre poste ?"] },
            erreur_delivrance: { name: "Karim", type: "management", role: "PrÃ©parateur junior", avatar: "ğŸ˜°", info: "StressÃ© par son erreur", suggestions: ["L'enfant a-t-il pris le mÃ©dicament ?", "PremiÃ¨re erreur ?", "VÃ©rification par le pharmacien ?", "Comment amÃ©liorer le process ?"] },
            client_prix_internet: { name: "M. Morel", type: "management", role: "Client occasionnel", avatar: "ğŸ›’", info: "RÃ¢leur, compare les prix", suggestions: ["C'est pour qui ce produit ?", "Vous en avez besoin maintenant ?", "Garantie et traÃ§abilitÃ© ?", "Nos services en plus ?"] },
            negociation_grossiste: { name: "FranÃ§ois", type: "management", role: "Dir. rÃ©gional Alliance Healthcare", avatar: "ğŸ“Š", info: "Professionnel, en position de force", suggestions: ["Conditions du concurrent ?", "Marge sur la livraison ?", "Autre grossiste m'a contactÃ©", "NÃ©gocier le palier ?"] },
            recadrage_retards: { name: "Thomas", type: "management", role: "PrÃ©parateur (3 ans)", avatar: "â°", info: "Sympathique mais dÃ©sinvolte", suggestions: ["Combien de retards ce mois ?", "Impact sur l'Ã©quipe ?", "Formaliser par Ã©crit ?", "Solutions proposÃ©es ?"] },
            avis_google_negatif: { name: "Mme Fontaine", type: "management", role: "Cliente (tÃ©lÃ©phone)", avatar: "â­", info: "Furieuse, veut des excuses", suggestions: ["Que s'est-il passÃ© exactement ?", "Vous Ãªtes cliente depuis longtemps ?", "Je m'excuse sincÃ¨rement", "On peut se voir pour en discuter ?"] }
        };
        let currentScenario = null, messages = [], score = 0, isTyping = false;

        function selectScenario(id) {
            currentScenario = { id, ...SCENARIOS[id] };
            messages = []; score = 0;
            const isManagement = currentScenario.type === 'management';
            document.getElementById('patientAvatar').textContent = currentScenario.avatar;
            document.getElementById('patientName').textContent = currentScenario.name;
            document.getElementById('chatLabel').textContent = isManagement ? 'ğŸ’¼ Interlocuteur' : 'ğŸ¥ Patient';
            document.getElementById('patientInfo').textContent = isManagement ? currentScenario.role + " â€¢ " + currentScenario.info : currentScenario.age + " ans â€¢ " + currentScenario.info;
            document.getElementById('suggestions').innerHTML = currentScenario.suggestions.map(s => `<button onclick="useSuggestion('${s.replace(/'/g, "\\'")}')">${s}</button>`).join('');
            document.getElementById('messages').innerHTML = '';
            document.getElementById('scoreValue').textContent = '0';
            document.getElementById('scoreBar').style.width = '0%';
            document.getElementById('scenarioSelection').style.display = 'none';
            document.getElementById('gameContainer').classList.add('active');
            setTimeout(() => sendToAPI("Bonjour, je viens d'arriver."), 500);
        }

        function useSuggestion(text) { document.getElementById('userInput').value = text; }

        function addMessage(type, content) {
            messages.push({ type, content });
            const avatar = type === 'patient' ? currentScenario.avatar : 'ğŸ‘¨â€âš•ï¸';
            document.getElementById('messages').innerHTML += `<div class="message ${type}"><div class="avatar">${avatar}</div><div class="bubble">${content}</div></div>`;
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
        }

        function showTyping() {
            isTyping = true;
            document.getElementById('sendBtn').disabled = true;
            document.getElementById('messages').innerHTML += `<div id="typing" class="message patient typing"><div class="avatar">${currentScenario.avatar}</div><div class="dots"><span></span><span></span><span></span></div></div>`;
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
        }

        function hideTyping() {
            isTyping = false;
            document.getElementById('sendBtn').disabled = false;
            const t = document.getElementById('typing'); if(t) t.remove();
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const msg = input.value.trim();
            if (!msg || isTyping) return;
            input.value = '';
            addMessage('pharmacist', msg);
            await sendToAPI(msg);
        }

        async function sendToAPI(userMessage) {
            showTyping();
            try {
                const res = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ scenarioId: currentScenario.id, messages, userMessage })
                });
                const data = await res.json();
                hideTyping();
                if (data.response) {
                    addMessage('patient', data.response);
                    updateScore(userMessage, data.response);
                }
            } catch (e) {
                hideTyping();
                addMessage('patient', "Pardon, pouvez-vous rÃ©pÃ©ter ?");
            }
        }

        function updateScore(q, a) {
            const ql = q.toLowerCase(), al = a.toLowerCase();
            let points = 0;
            // MÃ©dicaments cachÃ©s
            if ((ql.includes('autre') && ql.includes('mÃ©dicament')) || ql.includes('traitement') || ql.includes('prenez')) {
                if (al.includes('kardÃ©gic') || al.includes('lexomil') || al.includes('cardiologue') || al.includes('tamsulosine') || al.includes('arrÃªtÃ©') || al.includes('metformine') || al.includes('acide folique') || al.includes('stilnox') || al.includes('antidÃ©presseur') || al.includes('pilule')) points += 25;
            }
            // AutomÃ©dication
            if (ql.includes('pris') || ql.includes('donnÃ©') || ql.includes('automÃ©dication') || ql.includes('utilisÃ©') || ql.includes('appliquÃ©')) {
                if (al.includes('advil') || al.includes('ibuprofÃ¨ne') || al.includes('doliprane') || al.includes('internet') || al.includes('tiktok') || al.includes('Ã©crasÃ©') || al.includes('pÃ¢tÃ©e') || al.includes('laxatif') || al.includes('pÃ©rimÃ©') || al.includes('mayonnaise') || al.includes('grog') || al.includes('alcool') || al.includes('sirop') || al.includes('protÃ©ine') || al.includes('soja')) points += 20;
            }
            // AntÃ©cÃ©dents
            if (ql.includes('antÃ©cÃ©dent') || ql.includes('passÃ©') || ql.includes('famil') || ql.includes('dÃ©jÃ  eu')) {
                if (al.includes('ulcÃ¨re') || al.includes('asthme') || al.includes('convulsion') || al.includes('infarctus') || al.includes('pÃ¨re') || al.includes('dÃ©cÃ©dÃ©') || al.includes('cancer') || al.includes('bpco') || al.includes('diabÃ¨t')) points += 20;
            }
            // Allergies
            if (ql.includes('allergie')) points += 10;
            // Allaitement / grossesse
            if (ql.includes('allait') || ql.includes('enceinte') || ql.includes('bÃ©bÃ©') || ql.includes('nourri') || ql.includes('trimestre')) {
                if (al.includes('allait') || al.includes('bÃ©bÃ©') || al.includes('4 mois') || al.includes('enceinte') || al.includes('mois')) points += 25;
            }
            // RÃ©gime alimentaire
            if (ql.includes('rÃ©gime') || ql.includes('alimenta') || ql.includes('mange') || ql.includes('nutrition')) {
                if (al.includes('vÃ©gÃ©tari') || al.includes('viande') || al.includes('conserve') || al.includes('jeÃ»ne') || al.includes('peu')) points += 20;
            }
            // SymptÃ´mes spÃ©cifiques
            if (ql.includes('rÃ¨gle') || ql.includes('cheveu') || ql.includes('perte') || ql.includes('ongle')) {
                if (al.includes('rÃ¨gle') || al.includes('abondant') || al.includes('cheveu') || al.includes('cassant')) points += 20;
            }
            // Urgence cardiaque
            if ((ql.includes('irrad') || ql.includes('bras')) && al.includes('bras')) points += 25;
            if (ql.includes('essouffle') && (al.includes('essouffle') || al.includes('souffle'))) points += 20;
            if (ql.includes('fum') && (al.includes('fum') || al.includes('paquet'))) points += 15;
            // RÃ©orientation urgence/mÃ©decin
            if (ql.includes('urgence') || ql.includes('hÃ´pital') || ql.includes('15') || ql.includes('samu') || ql.includes('antipoison') || ql.includes('114')) points += 25;
            if (ql.includes('mÃ©decin') || ql.includes('sage-femme') || ql.includes('gynÃ©co') || ql.includes('pÃ©diatre') || ql.includes('planning')) points += 15;
            // VÃ©tÃ©rinaire
            if (ql.includes('vÃ©tÃ©rinaire') || ql.includes('vÃ©to')) {
                if (al.includes('vÃ©to') || al.includes('2 ans') || al.includes('pas vu')) points += 20;
            }
            // Prostate / suivi
            if ((ql.includes('psa') || (ql.includes('prostate') && ql.includes('contrÃ´l')) || ql.includes('urolog'))) {
                if (al.includes('psa') || al.includes('contrÃ´l') || al.includes('3 ans') || al.includes('sang')) points += 25;
            }
            // DiabÃ¨te et terrain
            if (ql.includes('diabÃ¨t') || ql.includes('sucre') || ql.includes('glycÃ©mi')) {
                if (al.includes('diabÃ¨t') || al.includes('metformine') || al.includes('sucr')) points += 20;
            }
            // Cloques / gravitÃ©
            if (ql.includes('cloque') || ql.includes('gravitÃ©') || ql.includes('degrÃ©')) {
                if (al.includes('cloque') || al.includes('2Ã¨me')) points += 20;
            }
            // Photosensibilisation
            if ((ql.includes('antibiotique') || ql.includes('mÃ©dicament')) && al.includes('doxycycline')) points += 25;
            // Contagion herpÃ¨s
            if (ql.includes('contagi') || ql.includes('embrass')) {
                if (al.includes('embrass') || al.includes('copain') || al.includes('contagi')) points += 20;
            }
            // FrÃ©quence rÃ©cidives
            if (ql.includes('frÃ©quen') || ql.includes('combien de fois') || ql.includes('rÃ©cidiv')) {
                if (al.includes('fois') || al.includes('an') || al.includes('rÃ©cidiv')) points += 15;
            }
            // DÃ©pendance / sevrage
            if (ql.includes('depuis') && (ql.includes('combien') || ql.includes('quand') || ql.includes('longtemps'))) {
                if (al.includes('15 ans') || al.includes('35 ans') || al.includes('2 jours') || al.includes('3 mois')) points += 15;
            }
            // Literie / environnement poux
            if (ql.includes('liter') || ql.includes('doudou') || ql.includes('drap') || ql.includes('parent')) {
                if (al.includes('liter') || al.includes('doudou') || al.includes('parent') || al.includes('lavÃ©')) points += 20;
            }
            // Cortisone / observance
            if (ql.includes('cortisone') || ql.includes('crÃ¨me prescrit') || ql.includes('appliqu')) {
                if (al.includes('peur') || al.includes('pas appliqu') || al.includes('naturel') || al.includes('cortisone')) points += 20;
            }
            // Maltraitance
            if (ql.includes('bleu') || ql.includes('chute') || ql.includes('escalier') || ql.includes('dÃ©jÃ  arrivÃ©')) {
                if (al.includes('3Ã¨me fois') || al.includes('tombÃ©') || al.includes('strict') || al.includes('beau-pÃ¨re')) points += 25;
            }
            // DÃ©sescalade
            if (ql.includes('comprend') || ql.includes('solution') || ql.includes('aide') || ql.includes('calme')) points += 10;

            // --- MANAGEMENT SCORING ---
            // DÃ©lÃ©guÃ© insistant
            if ((ql.includes('minimum') || ql.includes('quantitÃ©')) && (al.includes('500') || al.includes('minimum'))) points += 25;
            if ((ql.includes('rupture') || ql.includes('approvisionnement') || ql.includes('disponib')) && (al.includes('rupture') || al.includes('stock'))) points += 20;
            if (ql.includes('marge') && (al.includes('marge') || al.includes('infÃ©rieur') || al.includes('princeps'))) points += 25;
            if ((ql.includes('objectif') || (ql.includes('pourquoi') && ql.includes('offre'))) && (al.includes('objectif') || al.includes('concurrent'))) points += 20;
            // Conflit Ã©quipe
            if ((ql.includes('promotion') || ql.includes('poste') || ql.includes('changement')) && (al.includes('promotion') || al.includes('espÃ©rai') || al.includes('poste'))) points += 25;
            if ((ql.includes('personnel') || ql.includes('comment vous') || ql.includes('vous sentez')) && (al.includes('divorce') || al.includes('personnel') || al.includes('difficile'))) points += 25;
            if (ql.includes('mÃ©diation') || ql.includes('ensemble') || (ql.includes('rencontr') && ql.includes('marie'))) points += 20;
            // Demande augmentation
            if ((ql.includes('offre') || ql.includes('ailleurs') || ql.includes('proposÃ©')) && (al.includes('offre') || al.includes('autre pharmacie') || al.includes('300'))) points += 25;
            if ((ql.includes('responsabilit') || ql.includes('Ã©volution') || ql.includes('mission')) && (al.includes('responsabilit') || al.includes('formation'))) points += 20;
            if ((ql.includes('valoris') || ql.includes('garder') || ql.includes('arrangement') || ql.includes('alternative'))) points += 15;
            // Erreur dÃ©livrance
            if ((ql.includes('vÃ©rifi') || ql.includes('pharmacien') || ql.includes('contrÃ´le')) && (al.includes('tÃ©lÃ©phone') || al.includes('vÃ©rifi') || al.includes('pharmacien'))) points += 25;
            if ((ql.includes('premiÃ¨re fois') || ql.includes('dÃ©jÃ  arrivÃ©') || ql.includes('premiÃ¨re erreur')) && (al.includes('premiÃ¨re') || al.includes('jamais'))) points += 15;
            if (ql.includes('process') || ql.includes('procÃ©dure') || ql.includes('amÃ©liorer') || ql.includes('Ã©viter')) points += 20;
            // Client prix internet
            if ((ql.includes('pour qui') || ql.includes('enfant') || ql.includes('urgent') || ql.includes('besoin')) && (al.includes('brÃ»l') || al.includes('enfant') || al.includes('maintenant'))) points += 25;
            if (ql.includes('contrefaÃ§on') || ql.includes('garanti') || ql.includes('traÃ§abilit') || ql.includes('authentici')) points += 20;
            if (ql.includes('conseil') || ql.includes('service') || ql.includes('valeur ajoutÃ©')) points += 15;
            // NÃ©gociation grossiste
            if ((ql.includes('concurrent') || ql.includes('condition')) && (al.includes('concurrent') || al.includes('meilleur') || al.includes('condition'))) points += 20;
            if ((ql.includes('livraison') || ql.includes('frÃ©quence')) && (al.includes('livraison') || al.includes('nÃ©goci'))) points += 20;
            if ((ql.includes('autre grossiste') || ql.includes('approchÃ©') || ql.includes('proposition')) && (al.includes('approchÃ©') || al.includes('grossiste'))) points += 25;
            // Recadrage retards
            if ((ql.includes('combien') && ql.includes('retard')) && (al.includes('4') || al.includes('retard'))) points += 15;
            if ((ql.includes('Ã©quipe') || ql.includes('collÃ¨gue') || ql.includes('impact')) && (al.includes('agac') || al.includes('remarqu') || al.includes('Ã©quipe'))) points += 20;
            if (ql.includes('formaliser') || ql.includes('Ã©crit') || ql.includes('avertissement') || ql.includes('entretien')) points += 20;
            // Avis Google nÃ©gatif
            if (ql.includes('excus') || ql.includes('dÃ©solÃ©') || ql.includes('pardon')) points += 15;
            if ((ql.includes('informatique') || ql.includes('problÃ¨me') || ql.includes('panne')) && (al.includes('informatique') || al.includes('problÃ¨me') || al.includes('panne'))) points += 20;
            if (((ql.includes('client') || ql.includes('fidÃ¨le')) && ql.includes('depuis')) && (al.includes('20 ans') || al.includes('fidÃ¨le'))) points += 20;
            if (ql.includes('avis') && (ql.includes('modifier') || ql.includes('retirer') || ql.includes('changer'))) points += 15;

            if (points > 0) {
                score += points;
                document.getElementById('scoreValue').textContent = score;
                document.getElementById('scoreBar').style.width = Math.min(score, 100) + '%';
            }
        }

        function endSimulation() {
            let feedback = score >= 80 ? "ğŸ† Excellent travail ! Questionnement complet et pertinent." : score >= 50 ? "ğŸ‘ Bon travail, mais quelques pistes de questionnement manquÃ©es." : score >= 25 ? "âš ï¸ Plusieurs Ã©lÃ©ments importants n'ont pas Ã©tÃ© explorÃ©s." : "âŒ Beaucoup d'informations critiques non dÃ©tectÃ©es. Reprenez le scÃ©nario !";
            addMessage('patient', `[Fin de simulation]\n\n${feedback}\n\nScore: ${score} points`);
        }

        function backToSelection() {
            document.getElementById('scenarioSelection').style.display = 'block';
            document.getElementById('gameContainer').classList.remove('active');
        }
    </script>
</body>
</html>
