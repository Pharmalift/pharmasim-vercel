<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PharmaSim Pro | Pharmalift Solutions</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #0f172a, #1e293b); min-height: 100vh; color: #f8fafc; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 30px; }
        .logo { display: flex; align-items: center; gap: 12px; }
        .logo-icon { width: 50px; height: 50px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 28px; }
        .logo h1 { font-size: 24px; }
        .logo h1 span { color: #3b82f6; }
        .badge-pro { background: linear-gradient(135deg, #f59e0b, #d97706); padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 700; margin-left: 8px; }
        .status-badge { padding: 8px 16px; border-radius: 20px; font-size: 12px; font-weight: 600; background: rgba(139,92,246,0.2); color: #a78bfa; }
        .category-title { font-size: 16px; margin: 32px 0 16px; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.08); color: #e2e8f0; }
        .category-title:first-of-type { margin-top: 0; }
        .scenario-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 16px; margin-bottom: 20px; }
        .scenario-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 20px; cursor: pointer; transition: all 0.3s; }
        .scenario-card:hover { background: rgba(255,255,255,0.08); border-color: #3b82f6; transform: translateY(-2px); }
        .scenario-card .avatar { width: 52px; height: 52px; background: linear-gradient(135deg, #fbbf24, #f59e0b); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 26px; margin-bottom: 12px; }
        .scenario-card h3 { font-size: 16px; margin-bottom: 6px; }
        .scenario-card p { font-size: 12px; color: #94a3b8; line-height: 1.4; }
        .game-container { display: none; grid-template-columns: 1fr 320px; gap: 24px; }
        .game-container.active { display: grid; }
        .chat-panel { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; overflow: hidden; }
        .chat-header { background: linear-gradient(135deg, #3b82f6, #8b5cf6); padding: 20px; display: flex; align-items: center; gap: 16px; }
        .chat-header .avatar { width: 50px; height: 50px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 26px; }
        .chat-header h3 { font-size: 18px; }
        .chat-header p { font-size: 12px; opacity: 0.8; }
        .messages { height: 400px; overflow-y: auto; padding: 20px; background: #0f172a; }
        .message { display: flex; gap: 12px; margin-bottom: 16px; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .message.pharmacist { flex-direction: row-reverse; }
        .message .avatar { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
        .message.patient .avatar { background: #fbbf24; }
        .message.pharmacist .avatar { background: #3b82f6; }
        .message .bubble { max-width: 70%; padding: 12px 16px; border-radius: 16px; font-size: 14px; line-height: 1.5; }
        .message.patient .bubble { background: rgba(255,255,255,0.08); }
        .message.pharmacist .bubble { background: #3b82f6; }
        .typing .dots { display: flex; gap: 4px; padding: 12px 16px; background: rgba(255,255,255,0.08); border-radius: 16px; }
        .typing .dots span { width: 8px; height: 8px; background: #64748b; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; }
        .typing .dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing .dots span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        .input-area { padding: 20px; background: rgba(255,255,255,0.02); border-top: 1px solid rgba(255,255,255,0.1); }
        .suggestions { display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap; }
        .suggestions button { padding: 8px 12px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; font-size: 11px; color: #94a3b8; cursor: pointer; }
        .suggestions button:hover { background: rgba(59,130,246,0.2); border-color: #3b82f6; color: #60a5fa; }
        .input-row { display: flex; gap: 12px; }
        .input-row input { flex: 1; padding: 14px 18px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: #f8fafc; font-size: 14px; }
        .input-row input:focus { outline: none; border-color: #3b82f6; }
        .input-row input::placeholder { color: #64748b; }
        .input-row button { padding: 14px 24px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); border: none; border-radius: 12px; color: white; font-weight: 600; cursor: pointer; }
        .input-row button:disabled { opacity: 0.5; }
        .actions { display: flex; justify-content: space-between; margin-top: 12px; }
        .back-btn, .end-btn { padding: 10px; background: transparent; border: none; color: #64748b; font-size: 13px; cursor: pointer; }
        .end-btn { color: #f87171; }
        .side-panel { display: flex; flex-direction: column; gap: 16px; }
        .panel-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 20px; }
        .panel-card h3 { font-size: 14px; color: #94a3b8; margin-bottom: 12px; }
        .score-value { font-size: 32px; font-weight: 700; color: #4ade80; }
        .score-bar-bg { height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; margin-top: 12px; }
        .score-bar { height: 100%; background: #4ade80; border-radius: 4px; transition: width 0.5s; }
        footer { text-align: center; padding: 40px; color: #475569; font-size: 12px; }
        @media (max-width: 900px) { .game-container.active { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">üíä</div>
                <div><h1>Pharma<span>Sim</span><span class="badge-pro">PRO</span></h1></div>
            </div>
            <div class="status-badge">ü§ñ Propuls√© par Claude AI</div>
        </header>
        <div id="scenarioSelection">
            <h2 style="margin-bottom:24px;">Choisissez un sc√©nario</h2>

            <h3 class="category-title">üî¥ Risques critiques</h3>
            <div class="scenario-grid">
                <div class="scenario-card" onclick="selectScenario('douleur_thoracique')">
                    <div class="avatar" style="background:linear-gradient(135deg,#ef4444,#dc2626);">‚ö†Ô∏è</div>
                    <h3>M. Durand</h3>
                    <p>45 ans ‚Ä¢ Douleur thoracique. Signes d'alerte cardiaque √† rep√©rer !</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('femme_enceinte_medicaments')">
                    <div class="avatar" style="background:linear-gradient(135deg,#f472b6,#ec4899);">ü§∞</div>
                    <h3>Mme Laurent</h3>
                    <p>29 ans ‚Ä¢ Enceinte avec naus√©es. A pris un AINS sans le savoir.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('personne_agee_polymediquee')">
                    <div class="avatar" style="background:linear-gradient(135deg,#a78bfa,#7c3aed);">üëµ</div>
                    <h3>Mme Mercier</h3>
                    <p>82 ans ‚Ä¢ 12 m√©dicaments, confuse. Iatrog√©nie et chutes √† d√©tecter.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('intoxication_enfant')">
                    <div class="avatar" style="background:linear-gradient(135deg,#ef4444,#b91c1c);">üÜò</div>
                    <h3>Mme Girard</h3>
                    <p>Enfant 2 ans a aval√© des m√©dicaments. Gestion urgence toxicologique.</p>
                </div>
            </div>

            <h3 class="category-title">üü† Conseil sp√©cialis√©</h3>
            <div class="scenario-grid">
                <div class="scenario-card" onclick="selectScenario('mme_dubois')">
                    <div class="avatar">üë©‚Äçü¶≥</div>
                    <h3>Mme Dubois</h3>
                    <p>58 ans ‚Ä¢ Ordonnance + maux de t√™te. Interactions cach√©es.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('aromatherapie')">
                    <div class="avatar" style="background:linear-gradient(135deg,#34d399,#10b981);">üåø</div>
                    <h3>Mme Martin</h3>
                    <p>42 ans ‚Ä¢ Huiles essentielles stress/sommeil. Anxiolytique cach√©.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('phytotherapie_prostate')">
                    <div class="avatar" style="background:linear-gradient(135deg,#22c55e,#16a34a);">üå±</div>
                    <h3>M. Bernard</h3>
                    <p>62 ans ‚Ä¢ Prostate, veut du naturel. Traitement arr√™t√©, PSA non suivi.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('micronutrition_fatigue')">
                    <div class="avatar" style="background:linear-gradient(135deg,#fb923c,#f97316);">ü•ó</div>
                    <h3>Mme Faure</h3>
                    <p>35 ans ‚Ä¢ Fatigue intense, jeune maman. Carences cach√©es.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('menopause')">
                    <div class="avatar" style="background:linear-gradient(135deg,#f9a8d4,#ec4899);">üå∏</div>
                    <h3>Mme Blanchard</h3>
                    <p>52 ans ‚Ä¢ M√©nopause, refuse le THS. Ant√©c√©dent familial cancer.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('detox_drainage')">
                    <div class="avatar" style="background:linear-gradient(135deg,#86efac,#22c55e);">üßÉ</div>
                    <h3>Mme Petit</h3>
                    <p>28 ans ‚Ä¢ Cure d√©tox Instagram. Possible TCA √† d√©pister.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('sport_recuperation')">
                    <div class="avatar" style="background:linear-gradient(135deg,#60a5fa,#3b82f6);">üèÉ</div>
                    <h3>Thomas</h3>
                    <p>32 ans ‚Ä¢ Marathon, courbatures. Hydratation et progressivit√©.</p>
                </div>
            </div>

            <h3 class="category-title">üü° Populations sp√©cifiques</h3>
            <div class="scenario-grid">
                <div class="scenario-card" onclick="selectScenario('pediatrie')">
                    <div class="avatar" style="background:linear-gradient(135deg,#60a5fa,#3b82f6);">üë∂</div>
                    <h3>M. Petit (p√®re)</h3>
                    <p>Enfant 3 ans fi√©vreux. Convulsion f√©brile √† d√©tecter.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('bebe_coliques')">
                    <div class="avatar" style="background:linear-gradient(135deg,#fbbf24,#f59e0b);">üë∂</div>
                    <h3>Mme Dupont</h3>
                    <p>B√©b√© 3 semaines, coliques. Baby blues maternel √† d√©pister.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('personne_agee_isolee')">
                    <div class="avatar" style="background:linear-gradient(135deg,#94a3b8,#64748b);">üßì</div>
                    <h3>M. Martin</h3>
                    <p>78 ans ‚Ä¢ Confus, isol√©. Fragilit√© et risque domestique.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('femme_enceinte_rhume')">
                    <div class="avatar" style="background:linear-gradient(135deg,#fca5a5,#f87171);">ü§ß</div>
                    <h3>Mme Chen</h3>
                    <p>34 ans ‚Ä¢ Enceinte, rhume et fi√®vre. Autom√©dication √† risque.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('patient_diabetique')">
                    <div class="avatar" style="background:linear-gradient(135deg,#c084fc,#a855f7);">üíâ</div>
                    <h3>M. Kon√©</h3>
                    <p>58 ans ‚Ä¢ Diab√©tique, veut un sirop. Adaptation au terrain.</p>
                </div>
            </div>

            <h3 class="category-title">üü¢ Dermatologie comptoir</h3>
            <div class="scenario-grid">
                <div class="scenario-card" onclick="selectScenario('dermato')">
                    <div class="avatar" style="background:linear-gradient(135deg,#f472b6,#ec4899);">üíÜ</div>
                    <h3>Emma</h3>
                    <p>16 ans ‚Ä¢ Acn√©. Produits internet dangereux.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('eczema_bebe')">
                    <div class="avatar" style="background:linear-gradient(135deg,#fbbf24,#f59e0b);">üëß</div>
                    <h3>Mme Dubois-Morel</h3>
                    <p>B√©b√© 8 mois, ecz√©ma. Corticophobie √† lever.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('mycose_pied')">
                    <div class="avatar" style="background:linear-gradient(135deg,#34d399,#10b981);">ü¶∂</div>
                    <h3>M. Fernandez</h3>
                    <p>42 ans ‚Ä¢ Mycose pied, piscine. Diab√®te non signal√©.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('poux')">
                    <div class="avatar" style="background:linear-gradient(135deg,#fb923c,#f97316);">ü™≥</div>
                    <h3>Mme Martinez</h3>
                    <p>3 enfants, poux r√©cidivants. Traitement incomplet.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('coup_de_soleil')">
                    <div class="avatar" style="background:linear-gradient(135deg,#fbbf24,#f59e0b);">‚òÄÔ∏è</div>
                    <h3>Lucas</h3>
                    <p>22 ans ‚Ä¢ Coup de soleil s√©v√®re. M√©dicament photosensibilisant.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('herpes_labial')">
                    <div class="avatar" style="background:linear-gradient(135deg,#f9a8d4,#ec4899);">üíã</div>
                    <h3>Julie</h3>
                    <p>27 ans ‚Ä¢ Herp√®s r√©cidivant. Contagiosit√© et pr√©vention.</p>
                </div>
            </div>

            <h3 class="category-title">üîµ Situations d√©licates</h3>
            <div class="scenario-grid">
                <div class="scenario-card" onclick="selectScenario('veterinaire')">
                    <div class="avatar" style="background:linear-gradient(135deg,#a78bfa,#7c3aed);">üê±</div>
                    <h3>Mme Rossi</h3>
                    <p>55 ans ‚Ä¢ Chat malade. Advil donn√© √† l'animal.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('contraception_urgence')">
                    <div class="avatar" style="background:linear-gradient(135deg,#60a5fa,#3b82f6);">üíä</div>
                    <h3>Claire</h3>
                    <p>19 ans ‚Ä¢ Contraception d'urgence. Oublis r√©currents.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('test_grossesse_positif')">
                    <div class="avatar" style="background:linear-gradient(135deg,#c4b5fd,#8b5cf6);">ü•∫</div>
                    <h3>In√®s</h3>
                    <p>23 ans ‚Ä¢ Test positif, en pleurs. √âcoute et orientation.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('sevrage_tabac')">
                    <div class="avatar" style="background:linear-gradient(135deg,#94a3b8,#64748b);">üö¨</div>
                    <h3>M. Leroy</h3>
                    <p>55 ans ‚Ä¢ Veut arr√™ter de fumer. BPCO, forte d√©pendance.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('dependance_benzodiazepines')">
                    <div class="avatar" style="background:linear-gradient(135deg,#fca5a5,#f87171);">üò∞</div>
                    <h3>Mme Roux</h3>
                    <p>65 ans ‚Ä¢ Demande Lexomil sans ordonnance. D√©pendance.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('patient_agressif')">
                    <div class="avatar" style="background:linear-gradient(135deg,#ef4444,#dc2626);">üò†</div>
                    <h3>M. Sanchez</h3>
                    <p>40 ans ‚Ä¢ Rupture m√©dicament. D√©sescalade et empathie.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('suspicion_maltraitance')">
                    <div class="avatar" style="background:linear-gradient(135deg,#475569,#334155);">üíî</div>
                    <h3>Tim√©o (7 ans)</h3>
                    <p>Bleus r√©currents. Observation et protocole signalement.</p>
                </div>
            </div>
        </div>
        <div id="gameContainer" class="game-container">
            <div class="chat-panel">
                <div class="chat-header">
                    <div class="avatar" id="patientAvatar">üë©‚Äçü¶≥</div>
                    <div><h3 id="patientName">Patient</h3><p id="patientInfo">Info</p></div>
                </div>
                <div id="messages" class="messages"></div>
                <div class="input-area">
                    <div id="suggestions" class="suggestions"></div>
                    <div class="input-row">
                        <input type="text" id="userInput" placeholder="Posez votre question..." onkeypress="if(event.key==='Enter')sendMessage()">
                        <button id="sendBtn" onclick="sendMessage()">Envoyer</button>
                    </div>
                    <div class="actions">
                        <button class="back-btn" onclick="backToSelection()">‚Üê Retour</button>
                        <button class="end-btn" onclick="endSimulation()">üèÅ Terminer</button>
                    </div>
                </div>
            </div>
            <div class="side-panel">
                <div class="panel-card">
                    <h3>üìä Score</h3>
                    <div class="score-value" id="scoreValue">0</div>
                    <div class="score-bar-bg"><div id="scoreBar" class="score-bar" style="width:0%"></div></div>
                </div>
            </div>
        </div>
        <footer>PharmaSim Pro ¬© 2026 Pharmalift Solutions ‚Ä¢ Certification Qualiopi</footer>
    </div>
    <script>
        const SCENARIOS = {
            douleur_thoracique: { name: "M. Durand", age: 45, avatar: "‚ö†Ô∏è", info: "Press√©, minimise", suggestions: ["O√π exactement la douleur ?", "Irradiation bras ?", "Essoufflement ?", "Ant√©c√©dents familiaux ?"] },
            femme_enceinte_medicaments: { name: "Mme Laurent", age: 29, avatar: "ü§∞", info: "Enceinte, inqui√®te", suggestions: ["Pris quelque chose ?", "Quel trimestre ?", "Vomissements ?", "Suivi par qui ?"] },
            personne_agee_polymediquee: { name: "Mme Mercier", age: 82, avatar: "üëµ", info: "Confuse, polym√©diqu√©e", suggestions: ["Combien de m√©dicaments ?", "Chutes r√©centes ?", "Vivez seule ?", "Mangez bien ?"] },
            intoxication_enfant: { name: "Mme Girard", age: 30, avatar: "üÜò", info: "Paniqu√©e", suggestions: ["Quel m√©dicament ?", "Combien de comprim√©s ?", "Il y a combien de temps ?", "Poids de l'enfant ?"] },
            mme_dubois: { name: "Mme Dubois", age: 58, avatar: "üë©‚Äçü¶≥", info: "Press√©e mais coop√©rative", suggestions: ["Autres m√©dicaments ?", "Pris quelque chose ce matin ?", "Ant√©c√©dents ?", "D√©crivez la douleur"] },
            aromatherapie: { name: "Mme Martin", age: 42, avatar: "üåø", info: "Anxieuse, cherche du naturel", suggestions: ["Prenez-vous des m√©dicaments ?", "Utilisez d√©j√† des HE ?", "Ant√©c√©dents respiratoires ?", "Allergies cutan√©es ?"] },
            phytotherapie_prostate: { name: "M. Bernard", age: 62, avatar: "üå±", info: "M√©fiant, pr√©f√®re le naturel", suggestions: ["Autres m√©dicaments ?", "Traitement prescrit ?", "Suivi urologique ?", "Sang dans les urines ?"] },
            micronutrition_fatigue: { name: "Mme Faure", age: 35, avatar: "ü•ó", info: "√âpuis√©e, jeune maman", suggestions: ["Vous allaitez ?", "R√©gime alimentaire ?", "Autres sympt√¥mes ?", "R√®gles normales ?"] },
            menopause: { name: "Mme Blanchard", age: 52, avatar: "üå∏", info: "G√™n√©e, bouff√©es de chaleur", suggestions: ["Pourquoi refuser le THS ?", "Prenez des compl√©ments ?", "Sommeil ?", "Ant√©c√©dents familiaux ?"] },
            detox_drainage: { name: "Mme Petit", age: 28, avatar: "üßÉ", info: "Influenc√©e, wellness", suggestions: ["R√©gime alimentaire ?", "Perte de poids r√©cente ?", "Laxatifs ?", "Cheveux, ongles ?"] },
            sport_recuperation: { name: "Thomas", age: 32, avatar: "üèÉ", info: "Sportif motiv√©", suggestions: ["Hydratation ?", "Compl√©ments pris ?", "Crampes ?", "Depuis quand le sport ?"] },
            pediatrie: { name: "M. Petit", age: 35, avatar: "üë∂", info: "P√®re inquiet", suggestions: ["Quelle temp√©rature ?", "D√©j√† donn√© quelque chose ?", "Ant√©c√©dents de Lucas ?", "Combien p√®se-t-il ?"] },
            bebe_coliques: { name: "Mme Dupont", age: 30, avatar: "üë∂", info: "√âpuis√©e, premier b√©b√©", suggestions: ["Allaitement ou biberon ?", "Vu le p√©diatre ?", "R√©gurgitations ?", "Comment vous sentez-vous ?"] },
            personne_agee_isolee: { name: "M. Martin", age: 78, avatar: "üßì", info: "Fier, refuse l'aide", suggestions: ["Vivez seul ?", "Mangez bien ?", "Oubliez vos m√©dicaments ?", "Besoin d'aide au quotidien ?"] },
            femme_enceinte_rhume: { name: "Mme Chen", age: 34, avatar: "ü§ß", info: "Enceinte, enrhum√©e", suggestions: ["Avez-vous de la fi√®vre ?", "Pris quelque chose ?", "Appel√© la sage-femme ?", "Depuis quand ?"] },
            patient_diabetique: { name: "M. Kon√©", age: 58, avatar: "üíâ", info: "Diab√©tique, aime le sucr√©", suggestions: ["√ätes-vous diab√©tique ?", "Sirop sans sucre ?", "Suivi r√©gulier ?", "Pieds, sensations ?"] },
            dermato: { name: "Emma", age: 16, avatar: "üíÜ", info: "Timide, g√™n√©e", suggestions: ["Produits utilis√©s ?", "Type de peau ?", "Routine actuelle ?", "Depuis combien de temps ?"] },
            eczema_bebe: { name: "Mme Dubois-Morel", age: 32, avatar: "üëß", info: "Corticophobie", suggestions: ["Appliquez la cr√®me prescrite ?", "Cr√®mes utilis√©es ?", "Asthme familial ?", "B√©b√© dort bien ?"] },
            mycose_pied: { name: "M. Fernandez", age: 42, avatar: "ü¶∂", info: "G√™n√©, sportif", suggestions: ["Depuis combien de temps ?", "Piscine, sport ?", "Diab√©tique ?", "D√©j√† trait√© ?"] },
            poux: { name: "Mme Martinez", age: 38, avatar: "ü™≥", info: "D√©bord√©e, 3 enfants", suggestions: ["Parents trait√©s aussi ?", "Literie lav√©e ?", "Produit utilis√© ?", "√âcole pr√©venue ?"] },
            coup_de_soleil: { name: "Lucas", age: 22, avatar: "‚òÄÔ∏è", info: "√âtudiant, f√™te plage", suggestions: ["Des cloques ?", "Prenez des m√©dicaments ?", "Cr√®me solaire ?", "Grains de beaut√© ?"] },
            herpes_labial: { name: "Julie", age: 27, avatar: "üíã", info: "Stress√©e, entretien demain", suggestions: ["Fr√©quence des pouss√©es ?", "Quand avez-vous appliqu√© ?", "Contagion, pr√©cautions ?", "Vu un m√©decin ?"] },
            veterinaire: { name: "Mme Rossi", age: 55, avatar: "üê±", info: "Propri√©taire inqui√®te", suggestions: ["Donn√© quelque chose au chat ?", "Vu le v√©t√©rinaire ?", "Perte de poids ?", "Depuis combien de temps ?"] },
            contraception_urgence: { name: "Claire", age: 19, avatar: "üíä", info: "G√™n√©e, stress√©e", suggestions: ["Il y a combien de temps ?", "Contraception habituelle ?", "Cycle r√©gulier ?", "Suivi gyn√©co ?"] },
            test_grossesse_positif: { name: "In√®s", age: 23, avatar: "ü•∫", info: "En pleurs, perdue", suggestions: ["Souhaitez-vous en parler ?", "Entour√©e ?", "Connaissez vos options ?", "Suivi m√©dical ?"] },
            sevrage_tabac: { name: "M. Leroy", age: 55, avatar: "üö¨", info: "Fumeur, sceptique", suggestions: ["Combien par jour ?", "Premi√®re cigarette quand ?", "D√©j√† essay√© quoi ?", "Probl√®mes respiratoires ?"] },
            dependance_benzodiazepines: { name: "Mme Roux", age: 65, avatar: "üò∞", info: "Anxieuse, suppliante", suggestions: ["Depuis combien de temps ?", "Doses augment√©es ?", "Autres somnif√®res ?", "Votre m√©decin en pense quoi ?"] },
            patient_agressif: { name: "M. Sanchez", age: 40, avatar: "üò†", info: "En col√®re", suggestions: ["Depuis quand sans traitement ?", "Sympt√¥mes de manque ?", "On peut chercher une solution", "M√©decin joignable ?"] },
            suspicion_maltraitance: { name: "M√®re de Tim√©o", age: 35, avatar: "üíî", info: "R√©pond √† la place de l'enfant", suggestions: ["Comment c'est arriv√© ?", "D√©j√† arriv√© avant ?", "Tim√©o, tu peux me montrer ?", "D'autres bleus ?"] }
        };
        let currentScenario = null, messages = [], score = 0, isTyping = false;

        function selectScenario(id) {
            currentScenario = { id, ...SCENARIOS[id] };
            messages = []; score = 0;
            document.getElementById('patientAvatar').textContent = currentScenario.avatar;
            document.getElementById('patientName').textContent = currentScenario.name;
            document.getElementById('patientInfo').textContent = currentScenario.age + " ans ‚Ä¢ " + currentScenario.info;
            document.getElementById('suggestions').innerHTML = currentScenario.suggestions.map(s => `<button onclick="useSuggestion('${s.replace(/'/g, "\\'")}')">${s}</button>`).join('');
            document.getElementById('messages').innerHTML = '';
            document.getElementById('scoreValue').textContent = '0';
            document.getElementById('scoreBar').style.width = '0%';
            document.getElementById('scenarioSelection').style.display = 'none';
            document.getElementById('gameContainer').classList.add('active');
            setTimeout(() => sendToAPI("Bonjour, je viens d'arriver."), 500);
        }

        function useSuggestion(text) { document.getElementById('userInput').value = text; }

        function addMessage(type, content) {
            messages.push({ type, content });
            const avatar = type === 'patient' ? currentScenario.avatar : 'üë®‚Äç‚öïÔ∏è';
            document.getElementById('messages').innerHTML += `<div class="message ${type}"><div class="avatar">${avatar}</div><div class="bubble">${content}</div></div>`;
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
        }

        function showTyping() {
            isTyping = true;
            document.getElementById('sendBtn').disabled = true;
            document.getElementById('messages').innerHTML += `<div id="typing" class="message patient typing"><div class="avatar">${currentScenario.avatar}</div><div class="dots"><span></span><span></span><span></span></div></div>`;
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
        }

        function hideTyping() {
            isTyping = false;
            document.getElementById('sendBtn').disabled = false;
            const t = document.getElementById('typing'); if(t) t.remove();
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const msg = input.value.trim();
            if (!msg || isTyping) return;
            input.value = '';
            addMessage('pharmacist', msg);
            await sendToAPI(msg);
        }

        async function sendToAPI(userMessage) {
            showTyping();
            try {
                const res = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ scenarioId: currentScenario.id, messages, userMessage })
                });
                const data = await res.json();
                hideTyping();
                if (data.response) {
                    addMessage('patient', data.response);
                    updateScore(userMessage, data.response);
                }
            } catch (e) {
                hideTyping();
                addMessage('patient', "Pardon, pouvez-vous r√©p√©ter ?");
            }
        }

        function updateScore(q, a) {
            const ql = q.toLowerCase(), al = a.toLowerCase();
            let points = 0;
            // M√©dicaments cach√©s
            if ((ql.includes('autre') && ql.includes('m√©dicament')) || ql.includes('traitement') || ql.includes('prenez')) {
                if (al.includes('kard√©gic') || al.includes('lexomil') || al.includes('cardiologue') || al.includes('tamsulosine') || al.includes('arr√™t√©') || al.includes('metformine') || al.includes('acide folique') || al.includes('stilnox') || al.includes('antid√©presseur') || al.includes('pilule')) points += 25;
            }
            // Autom√©dication
            if (ql.includes('pris') || ql.includes('donn√©') || ql.includes('autom√©dication') || ql.includes('utilis√©') || ql.includes('appliqu√©')) {
                if (al.includes('advil') || al.includes('ibuprof√®ne') || al.includes('doliprane') || al.includes('internet') || al.includes('tiktok') || al.includes('√©cras√©') || al.includes('p√¢t√©e') || al.includes('laxatif') || al.includes('p√©rim√©') || al.includes('mayonnaise') || al.includes('grog') || al.includes('alcool') || al.includes('sirop') || al.includes('prot√©ine') || al.includes('soja')) points += 20;
            }
            // Ant√©c√©dents
            if (ql.includes('ant√©c√©dent') || ql.includes('pass√©') || ql.includes('famil') || ql.includes('d√©j√† eu')) {
                if (al.includes('ulc√®re') || al.includes('asthme') || al.includes('convulsion') || al.includes('infarctus') || al.includes('p√®re') || al.includes('d√©c√©d√©') || al.includes('cancer') || al.includes('bpco') || al.includes('diab√®t')) points += 20;
            }
            // Allergies
            if (ql.includes('allergie')) points += 10;
            // Allaitement / grossesse
            if (ql.includes('allait') || ql.includes('enceinte') || ql.includes('b√©b√©') || ql.includes('nourri') || ql.includes('trimestre')) {
                if (al.includes('allait') || al.includes('b√©b√©') || al.includes('4 mois') || al.includes('enceinte') || al.includes('mois')) points += 25;
            }
            // R√©gime alimentaire
            if (ql.includes('r√©gime') || ql.includes('alimenta') || ql.includes('mange') || ql.includes('nutrition')) {
                if (al.includes('v√©g√©tari') || al.includes('viande') || al.includes('conserve') || al.includes('je√ªne') || al.includes('peu')) points += 20;
            }
            // Sympt√¥mes sp√©cifiques
            if (ql.includes('r√®gle') || ql.includes('cheveu') || ql.includes('perte') || ql.includes('ongle')) {
                if (al.includes('r√®gle') || al.includes('abondant') || al.includes('cheveu') || al.includes('cassant')) points += 20;
            }
            // Urgence cardiaque
            if ((ql.includes('irrad') || ql.includes('bras')) && al.includes('bras')) points += 25;
            if (ql.includes('essouffle') && (al.includes('essouffle') || al.includes('souffle'))) points += 20;
            if (ql.includes('fum') && (al.includes('fum') || al.includes('paquet'))) points += 15;
            // R√©orientation urgence/m√©decin
            if (ql.includes('urgence') || ql.includes('h√¥pital') || ql.includes('15') || ql.includes('samu') || ql.includes('antipoison') || ql.includes('114')) points += 25;
            if (ql.includes('m√©decin') || ql.includes('sage-femme') || ql.includes('gyn√©co') || ql.includes('p√©diatre') || ql.includes('planning')) points += 15;
            // V√©t√©rinaire
            if (ql.includes('v√©t√©rinaire') || ql.includes('v√©to')) {
                if (al.includes('v√©to') || al.includes('2 ans') || al.includes('pas vu')) points += 20;
            }
            // Prostate / suivi
            if ((ql.includes('psa') || (ql.includes('prostate') && ql.includes('contr√¥l')) || ql.includes('urolog'))) {
                if (al.includes('psa') || al.includes('contr√¥l') || al.includes('3 ans') || al.includes('sang')) points += 25;
            }
            // Diab√®te et terrain
            if (ql.includes('diab√®t') || ql.includes('sucre') || ql.includes('glyc√©mi')) {
                if (al.includes('diab√®t') || al.includes('metformine') || al.includes('sucr')) points += 20;
            }
            // Cloques / gravit√©
            if (ql.includes('cloque') || ql.includes('gravit√©') || ql.includes('degr√©')) {
                if (al.includes('cloque') || al.includes('2√®me')) points += 20;
            }
            // Photosensibilisation
            if ((ql.includes('antibiotique') || ql.includes('m√©dicament')) && al.includes('doxycycline')) points += 25;
            // Contagion herp√®s
            if (ql.includes('contagi') || ql.includes('embrass')) {
                if (al.includes('embrass') || al.includes('copain') || al.includes('contagi')) points += 20;
            }
            // Fr√©quence r√©cidives
            if (ql.includes('fr√©quen') || ql.includes('combien de fois') || ql.includes('r√©cidiv')) {
                if (al.includes('fois') || al.includes('an') || al.includes('r√©cidiv')) points += 15;
            }
            // D√©pendance / sevrage
            if (ql.includes('depuis') && (ql.includes('combien') || ql.includes('quand') || ql.includes('longtemps'))) {
                if (al.includes('15 ans') || al.includes('35 ans') || al.includes('2 jours') || al.includes('3 mois')) points += 15;
            }
            // Literie / environnement poux
            if (ql.includes('liter') || ql.includes('doudou') || ql.includes('drap') || ql.includes('parent')) {
                if (al.includes('liter') || al.includes('doudou') || al.includes('parent') || al.includes('lav√©')) points += 20;
            }
            // Cortisone / observance
            if (ql.includes('cortisone') || ql.includes('cr√®me prescrit') || ql.includes('appliqu')) {
                if (al.includes('peur') || al.includes('pas appliqu') || al.includes('naturel') || al.includes('cortisone')) points += 20;
            }
            // Maltraitance
            if (ql.includes('bleu') || ql.includes('chute') || ql.includes('escalier') || ql.includes('d√©j√† arriv√©')) {
                if (al.includes('3√®me fois') || al.includes('tomb√©') || al.includes('strict') || al.includes('beau-p√®re')) points += 25;
            }
            // D√©sescalade
            if (ql.includes('comprend') || ql.includes('solution') || ql.includes('aide') || ql.includes('calme')) points += 10;

            if (points > 0) {
                score += points;
                document.getElementById('scoreValue').textContent = score;
                document.getElementById('scoreBar').style.width = Math.min(score, 100) + '%';
            }
        }

        function endSimulation() {
            let feedback = score >= 80 ? "üèÜ Excellent travail ! Questionnement complet et pertinent." : score >= 50 ? "üëç Bon travail, mais quelques pistes de questionnement manqu√©es." : score >= 25 ? "‚ö†Ô∏è Plusieurs √©l√©ments importants n'ont pas √©t√© explor√©s." : "‚ùå Beaucoup d'informations critiques non d√©tect√©es. Reprenez le sc√©nario !";
            addMessage('patient', `[Fin de simulation]\n\n${feedback}\n\nScore: ${score} points`);
        }

        function backToSelection() {
            document.getElementById('scenarioSelection').style.display = 'block';
            document.getElementById('gameContainer').classList.remove('active');
        }
    </script>
</body>
</html>
