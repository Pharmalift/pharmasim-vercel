<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PharmaSim Pro | Pharmalift Solutions</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #0f172a, #1e293b); min-height: 100vh; color: #f8fafc; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 30px; }
        .logo { display: flex; align-items: center; gap: 12px; }
        .logo-icon { width: 50px; height: 50px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 28px; }
        .logo h1 { font-size: 24px; }
        .logo h1 span { color: #3b82f6; }
        .badge-pro { background: linear-gradient(135deg, #f59e0b, #d97706); padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 700; margin-left: 8px; }
        .status-badge { padding: 8px 16px; border-radius: 20px; font-size: 12px; font-weight: 600; background: rgba(139,92,246,0.2); color: #a78bfa; }
        .scenario-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .scenario-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 24px; cursor: pointer; transition: all 0.3s; }
        .scenario-card:hover { background: rgba(255,255,255,0.08); border-color: #3b82f6; transform: translateY(-2px); }
        .scenario-card .avatar { width: 60px; height: 60px; background: linear-gradient(135deg, #fbbf24, #f59e0b); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; margin-bottom: 16px; }
        .scenario-card h3 { font-size: 18px; margin-bottom: 8px; }
        .scenario-card p { font-size: 13px; color: #94a3b8; line-height: 1.5; }
        .game-container { display: none; grid-template-columns: 1fr 320px; gap: 24px; }
        .game-container.active { display: grid; }
        .chat-panel { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; overflow: hidden; }
        .chat-header { background: linear-gradient(135deg, #3b82f6, #8b5cf6); padding: 20px; display: flex; align-items: center; gap: 16px; }
        .chat-header .avatar { width: 50px; height: 50px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 26px; }
        .chat-header h3 { font-size: 18px; }
        .chat-header p { font-size: 12px; opacity: 0.8; }
        .messages { height: 400px; overflow-y: auto; padding: 20px; background: #0f172a; }
        .message { display: flex; gap: 12px; margin-bottom: 16px; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .message.pharmacist { flex-direction: row-reverse; }
        .message .avatar { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
        .message.patient .avatar { background: #fbbf24; }
        .message.pharmacist .avatar { background: #3b82f6; }
        .message .bubble { max-width: 70%; padding: 12px 16px; border-radius: 16px; font-size: 14px; line-height: 1.5; }
        .message.patient .bubble { background: rgba(255,255,255,0.08); }
        .message.pharmacist .bubble { background: #3b82f6; }
        .typing .dots { display: flex; gap: 4px; padding: 12px 16px; background: rgba(255,255,255,0.08); border-radius: 16px; }
        .typing .dots span { width: 8px; height: 8px; background: #64748b; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; }
        .typing .dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing .dots span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        .input-area { padding: 20px; background: rgba(255,255,255,0.02); border-top: 1px solid rgba(255,255,255,0.1); }
        .suggestions { display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap; }
        .suggestions button { padding: 8px 12px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; font-size: 11px; color: #94a3b8; cursor: pointer; }
        .suggestions button:hover { background: rgba(59,130,246,0.2); border-color: #3b82f6; color: #60a5fa; }
        .input-row { display: flex; gap: 12px; }
        .input-row input { flex: 1; padding: 14px 18px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: #f8fafc; font-size: 14px; }
        .input-row input:focus { outline: none; border-color: #3b82f6; }
        .input-row input::placeholder { color: #64748b; }
        .input-row button { padding: 14px 24px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); border: none; border-radius: 12px; color: white; font-weight: 600; cursor: pointer; }
        .input-row button:disabled { opacity: 0.5; }
        .actions { display: flex; justify-content: space-between; margin-top: 12px; }
        .back-btn, .end-btn { padding: 10px; background: transparent; border: none; color: #64748b; font-size: 13px; cursor: pointer; }
        .end-btn { color: #f87171; }
        .side-panel { display: flex; flex-direction: column; gap: 16px; }
        .panel-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 20px; }
        .panel-card h3 { font-size: 14px; color: #94a3b8; margin-bottom: 12px; }
        .score-value { font-size: 32px; font-weight: 700; color: #4ade80; }
        .score-bar-bg { height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; margin-top: 12px; }
        .score-bar { height: 100%; background: #4ade80; border-radius: 4px; transition: width 0.5s; }
        footer { text-align: center; padding: 40px; color: #475569; font-size: 12px; }
        @media (max-width: 900px) { .game-container.active { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">üíä</div>
                <div><h1>Pharma<span>Sim</span><span class="badge-pro">PRO</span></h1></div>
            </div>
            <div class="status-badge">ü§ñ Propuls√© par Claude AI</div>
        </header>
        <div id="scenarioSelection">
            <h2 style="margin-bottom:24px;">Choisissez un sc√©nario</h2>
            <div class="scenario-grid">
                <div class="scenario-card" onclick="selectScenario('mme_dubois')">
                    <div class="avatar">üë©‚Äçü¶≥</div>
                    <h3>Mme Dubois</h3>
                    <p>58 ans ‚Ä¢ Ordonnance + maux de t√™te. Attention aux interactions cach√©es...</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('aromatherapie')">
                    <div class="avatar" style="background:linear-gradient(135deg,#34d399,#10b981);">üåø</div>
                    <h3>Mme Martin</h3>
                    <p>42 ans ‚Ä¢ Huiles essentielles pour stress/sommeil. Traitement anxiolytique cach√©.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('pediatrie')">
                    <div class="avatar" style="background:linear-gradient(135deg,#60a5fa,#3b82f6);">üë∂</div>
                    <h3>M. Petit (p√®re)</h3>
                    <p>Enfant 3 ans fi√©vreux. Ant√©c√©dent de convulsion f√©brile √† d√©tecter.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('dermato')">
                    <div class="avatar" style="background:linear-gradient(135deg,#f472b6,#ec4899);">üíÜ</div>
                    <h3>Emma</h3>
                    <p>16 ans ‚Ä¢ Acn√©. A utilis√© des produits internet dangereux.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('phytotherapie')">
                    <div class="avatar" style="background:linear-gradient(135deg,#22c55e,#16a34a);">üå±</div>
                    <h3>M. Bernard</h3>
                    <p>62 ans ‚Ä¢ Probl√®mes prostate, veut du naturel. Traitement arr√™t√© en cachette.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('micronutrition')">
                    <div class="avatar" style="background:linear-gradient(135deg,#fb923c,#f97316);">ü•ó</div>
                    <h3>Mme Faure</h3>
                    <p>35 ans ‚Ä¢ Fatigue intense, jeune maman. Carences cach√©es √† d√©tecter.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('veterinaire')">
                    <div class="avatar" style="background:linear-gradient(135deg,#a78bfa,#7c3aed);">üê±</div>
                    <h3>Mme Rossi</h3>
                    <p>55 ans ‚Ä¢ Chat malade. Autom√©dication humaine dangereuse sur l'animal.</p>
                </div>
                <div class="scenario-card" onclick="selectScenario('urgence')">
                    <div class="avatar" style="background:linear-gradient(135deg,#ef4444,#dc2626);">‚ö†Ô∏è</div>
                    <h3>M. Durand</h3>
                    <p>45 ans ‚Ä¢ Douleur thoracique. Signes d'alerte cardiaque √† rep√©rer !</p>
                </div>
            </div>
        </div>
        <div id="gameContainer" class="game-container">
            <div class="chat-panel">
                <div class="chat-header">
                    <div class="avatar" id="patientAvatar">üë©‚Äçü¶≥</div>
                    <div><h3 id="patientName">Patient</h3><p id="patientInfo">Info</p></div>
                </div>
                <div id="messages" class="messages"></div>
                <div class="input-area">
                    <div id="suggestions" class="suggestions"></div>
                    <div class="input-row">
                        <input type="text" id="userInput" placeholder="Posez votre question..." onkeypress="if(event.key==='Enter')sendMessage()">
                        <button id="sendBtn" onclick="sendMessage()">Envoyer</button>
                    </div>
                    <div class="actions">
                        <button class="back-btn" onclick="backToSelection()">‚Üê Retour</button>
                        <button class="end-btn" onclick="endSimulation()">üèÅ Terminer</button>
                    </div>
                </div>
            </div>
            <div class="side-panel">
                <div class="panel-card">
                    <h3>üìä Score</h3>
                    <div class="score-value" id="scoreValue">0</div>
                    <div class="score-bar-bg"><div id="scoreBar" class="score-bar" style="width:0%"></div></div>
                </div>
            </div>
        </div>
        <footer>PharmaSim Pro ¬© 2026 Pharmalift Solutions ‚Ä¢ Certification Qualiopi</footer>
    </div>
    <script>
        const SCENARIOS = {
            mme_dubois: { name: "Mme Dubois", age: 58, avatar: "üë©‚Äçü¶≥", info: "Press√©e mais coop√©rative", suggestions: ["Autres m√©dicaments ?", "Pris quelque chose ce matin ?", "Ant√©c√©dents ?", "D√©crivez la douleur"] },
            aromatherapie: { name: "Mme Martin", age: 42, avatar: "üåø", info: "Anxieuse, cherche du naturel", suggestions: ["Prenez-vous des m√©dicaments ?", "Utilisez d√©j√† des HE ?", "Ant√©c√©dents respiratoires ?", "Allergies cutan√©es ?"] },
            pediatrie: { name: "M. Petit", age: 35, avatar: "üë∂", info: "P√®re inquiet", suggestions: ["Quelle temp√©rature ?", "D√©j√† donn√© quelque chose ?", "Ant√©c√©dents de Lucas ?", "Combien p√®se-t-il ?"] },
            dermato: { name: "Emma", age: 16, avatar: "üíÜ", info: "Timide, g√™n√©e", suggestions: ["Produits utilis√©s ?", "Type de peau ?", "Routine actuelle ?", "Depuis combien de temps ?"] },
            phytotherapie: { name: "M. Bernard", age: 62, avatar: "üå±", info: "M√©fiant, pr√©f√®re le naturel", suggestions: ["Autres m√©dicaments ?", "Traitement prescrit ?", "Suivi urologique ?", "Depuis quand ces sympt√¥mes ?"] },
            micronutrition: { name: "Mme Faure", age: 35, avatar: "ü•ó", info: "√âpuis√©e, jeune maman", suggestions: ["Vous allaitez ?", "R√©gime alimentaire ?", "Autres sympt√¥mes ?", "R√®gles normales ?"] },
            veterinaire: { name: "Mme Rossi", age: 55, avatar: "üê±", info: "Propri√©taire inqui√®te", suggestions: ["Donn√© quelque chose au chat ?", "Vu le v√©t√©rinaire ?", "Autres sympt√¥mes ?", "Depuis combien de temps ?"] },
            urgence: { name: "M. Durand", age: 45, avatar: "‚ö†Ô∏è", info: "Press√©, minimise", suggestions: ["O√π exactement la douleur ?", "Irradiation ?", "Essoufflement ?", "Ant√©c√©dents familiaux ?"] }
        };
        let currentScenario = null, messages = [], score = 0, isTyping = false;

        function selectScenario(id) {
            currentScenario = { id, ...SCENARIOS[id] };
            messages = []; score = 0;
            document.getElementById('patientAvatar').textContent = currentScenario.avatar;
            document.getElementById('patientName').textContent = currentScenario.name;
            document.getElementById('patientInfo').textContent = currentScenario.age + " ans ‚Ä¢ " + currentScenario.info;
            document.getElementById('suggestions').innerHTML = currentScenario.suggestions.map(s => `<button onclick="useSuggestion('${s}')">${s}</button>`).join('');
            document.getElementById('messages').innerHTML = '';
            document.getElementById('scoreValue').textContent = '0';
            document.getElementById('scoreBar').style.width = '0%';
            document.getElementById('scenarioSelection').style.display = 'none';
            document.getElementById('gameContainer').classList.add('active');
            setTimeout(() => sendToAPI("Bonjour, je viens d'arriver."), 500);
        }

        function useSuggestion(text) { document.getElementById('userInput').value = text; }

        function addMessage(type, content) {
            messages.push({ type, content });
            const avatar = type === 'patient' ? currentScenario.avatar : 'üë®‚Äç‚öïÔ∏è';
            document.getElementById('messages').innerHTML += `<div class="message ${type}"><div class="avatar">${avatar}</div><div class="bubble">${content}</div></div>`;
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
        }

        function showTyping() {
            isTyping = true;
            document.getElementById('sendBtn').disabled = true;
            document.getElementById('messages').innerHTML += `<div id="typing" class="message patient typing"><div class="avatar">${currentScenario.avatar}</div><div class="dots"><span></span><span></span><span></span></div></div>`;
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
        }

        function hideTyping() {
            isTyping = false;
            document.getElementById('sendBtn').disabled = false;
            const t = document.getElementById('typing'); if(t) t.remove();
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const msg = input.value.trim();
            if (!msg || isTyping) return;
            input.value = '';
            addMessage('pharmacist', msg);
            await sendToAPI(msg);
        }

        async function sendToAPI(userMessage) {
            showTyping();
            try {
                const res = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ scenarioId: currentScenario.id, messages, userMessage })
                });
                const data = await res.json();
                hideTyping();
                if (data.response) {
                    addMessage('patient', data.response);
                    updateScore(userMessage, data.response);
                }
            } catch (e) {
                hideTyping();
                addMessage('patient', "Pardon, pouvez-vous r√©p√©ter ?");
            }
        }

        function updateScore(q, a) {
            const ql = q.toLowerCase(), al = a.toLowerCase();
            if ((ql.includes('autre') && ql.includes('m√©dicament')) || ql.includes('traitement')) {
                if (al.includes('kard√©gic') || al.includes('lexomil') || al.includes('cardiologue') || al.includes('tamsulosine') || al.includes('arr√™t√©')) score += 25;
            }
            if (ql.includes('pris') || ql.includes('donn√©') || ql.includes('autom√©dication')) {
                if (al.includes('advil') || al.includes('doliprane') || al.includes('internet') || al.includes('tiktok') || al.includes('√©cras√©') || al.includes('p√¢t√©e')) score += 20;
            }
            if (ql.includes('ant√©c√©dent') || ql.includes('pass√©') || ql.includes('famil')) {
                if (al.includes('ulc√®re') || al.includes('asthme') || al.includes('convulsion') || al.includes('infarctus') || al.includes('p√®re') || al.includes('d√©c√©d√©')) score += 20;
            }
            if (ql.includes('allergie')) score += 10;
            if (ql.includes('allait') || ql.includes('b√©b√©') || ql.includes('nourri')) {
                if (al.includes('allait') || al.includes('b√©b√©') || al.includes('4 mois')) score += 25;
            }
            if (ql.includes('r√©gime') || ql.includes('alimenta') || ql.includes('mange')) {
                if (al.includes('v√©g√©tari') || al.includes('viande')) score += 20;
            }
            if (ql.includes('r√®gle') || ql.includes('cheveu') || ql.includes('perte')) {
                if (al.includes('r√®gle') || al.includes('abondant') || al.includes('cheveu')) score += 20;
            }
            if ((ql.includes('irrad') || ql.includes('bras')) && al.includes('bras')) score += 25;
            if (ql.includes('essouffle') && (al.includes('essouffle') || al.includes('souffle'))) score += 20;
            if (ql.includes('fum') && (al.includes('fum') || al.includes('paquet'))) score += 15;
            if (ql.includes('v√©t√©rinaire') || ql.includes('v√©to')) {
                if (al.includes('v√©to') || al.includes('2 ans') || al.includes('pas vu')) score += 20;
            }
            if (ql.includes('psa') || ql.includes('prostate') && ql.includes('contr√¥l')) {
                if (al.includes('psa') || al.includes('contr√¥l') || al.includes('3 ans')) score += 25;
            }
            if (ql.includes('urgence') || ql.includes('h√¥pital') || ql.includes('15') || ql.includes('samu')) score += 25;
            document.getElementById('scoreValue').textContent = score;
            document.getElementById('scoreBar').style.width = Math.min(score, 100) + '%';
        }

        function endSimulation() {
            let feedback = score >= 60 ? "üèÜ Excellent travail !" : score >= 30 ? "üëç Bon travail, quelques points √† am√©liorer." : "‚ö†Ô∏è Plusieurs √©l√©ments importants manqu√©s.";
            addMessage('patient', `[Fin de simulation]\n\n${feedback}\n\nScore: ${score} points`);
        }

        function backToSelection() {
            document.getElementById('scenarioSelection').style.display = 'block';
            document.getElementById('gameContainer').classList.remove('active');
        }
    </script>
</body>
</html>
